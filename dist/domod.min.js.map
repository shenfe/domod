{"version":3,"file":"domod.min.js","sources":["../src/Util.js","../src/OArray.js","../src/Kernel.js","../src/Parser.js","../src/index.js","../src/Polyfill.js"],"sourcesContent":["var gid = (function () {\r\n    var n = 0;\r\n    return function () {\r\n        return n++;\r\n    };\r\n})();\r\n\r\nvar uid = function () {\r\n    return new Date().getTime() * 10000 + Math.floor(Math.random() * 10000);\r\n};\r\n\r\nvar isBoolean = function (v) {\r\n    return typeof v === 'boolean';\r\n};\r\n\r\nvar isNumber = function (v) {\r\n    return typeof v === 'number';\r\n};\r\n\r\nvar isNumeric = function (v) {\r\n    var n = parseInt(v);\r\n    if (isNaN(n)) return false;\r\n    return (typeof v === 'number' || typeof v === 'string') && n == v;\r\n};\r\n\r\nvar isString = function (v) {\r\n    return typeof v === 'string';\r\n};\r\n\r\nvar isFunction = function (v) {\r\n    return typeof v === 'function';\r\n};\r\n\r\nvar isObject = function (v) {\r\n    return v != null && !(v instanceof Array) && Object.prototype.toString.call(v) === '[object Object]';\r\n};\r\n\r\nvar isArray = function (v) {\r\n    return Object.prototype.toString.call(v) === '[object Array]';\r\n};\r\n\r\nvar isLikeArray = function (v) {\r\n    return v instanceof Array;\r\n};\r\n\r\nvar isBasic = function (v) {\r\n    return v == null\r\n        || typeof v === 'boolean'\r\n        || typeof v === 'number'\r\n        || typeof v === 'string'\r\n        || typeof v === 'function';\r\n};\r\n\r\nvar isInstance = function (v, creator) {\r\n    return typeof creator === 'function' && v instanceof creator;\r\n};\r\n\r\nvar isDirectInstance = function (v, creator) {\r\n    return v.constructor === creator;\r\n};\r\n\r\nvar isNode = function (v) {\r\n    if (typeof Node !== 'function') return false;\r\n    return v instanceof Node;\r\n};\r\n\r\nvar isNamedNodeMap = function (v) {\r\n    return v instanceof NamedNodeMap;\r\n};\r\n\r\nvar isEventName = function (v) {\r\n    if (!isString(v) || !v.startsWith('on')) return false;\r\n    return v.substr(2); // TODO\r\n};\r\n\r\nvar isCSSSelector = function (v) {\r\n    return v.indexOf(' ') > 0 || v.indexOf('.') >= 0\r\n        || v.indexOf('[') >= 0 || v.indexOf('#') >= 0;\r\n};\r\n\r\nvar each = function (v, func, arrayReverse) {\r\n    var i;\r\n    var len;\r\n    if (!isArray(v) && isFunction(v.forEach)) {\r\n        v.forEach(func);\r\n    } else if (isObject(v)) {\r\n        for (var p in v) {\r\n            if (!v.hasOwnProperty(p)) continue;\r\n            if (func(v[p], p) === false) break;\r\n        }\r\n    } else if (isLikeArray(v)) {\r\n        if (!arrayReverse) {\r\n            for (i = 0, len = v.length; i < len; i++) {\r\n                if (func(v[i], i) === false) break;\r\n            }\r\n        } else {\r\n            for (i = v.length - 1; i >= 0; i--) {\r\n                if (func(v[i], i) === false) break;\r\n            }\r\n        }\r\n    } else if (isNode(v)) {\r\n        var ret = false;\r\n        switch (v.nodeType) {\r\n        case Node.ELEMENT_NODE:\r\n            break;\r\n        case Node.TEXT_NODE:\r\n        case Node.COMMENT_NODE:\r\n        case Node.PROCESSING_INSTRUCTION_NODE:\r\n        case Node.DOCUMENT_NODE:\r\n        case Node.DOCUMENT_TYPE_NODE:\r\n        case Node.DOCUMENT_FRAGMENT_NODE:\r\n        default:\r\n            ret = true;\r\n        }\r\n        if (ret) return;\r\n        var childNodes = v.childNodes;\r\n        for (i = 0, len = childNodes.length; i < len; i++) {\r\n            if (!childNodes[i]) break;\r\n            func(childNodes[i]);\r\n            each(childNodes[i], func);\r\n        }\r\n    } else if (isNamedNodeMap(v)) {\r\n        for (i = 0, len = v.length; i < len; i++) {\r\n            if (func(v[i]['nodeValue'], v[i]['nodeName']) === false) break;\r\n        }\r\n    }\r\n};\r\n\r\nvar eachIndexOf = function (str, pat) {\r\n    var p0 = 0;\r\n    var p1;\r\n    var len = str.length;\r\n    var r = [];\r\n    while (p0 < len) {\r\n        p1 = str.indexOf(pat, p0);\r\n        if (p1 < len) {\r\n            r.push(p1);\r\n            p0 = p1 + pat.length;\r\n        }\r\n    }\r\n    return r;\r\n};\r\n\r\nvar eachUnique = function (arr, func) {\r\n    if (!isLikeArray(arr)) return;\r\n    var map = {};\r\n    for (var i = 0, len = arr.length; i < len; i++) {\r\n        var vi = arr[i];\r\n        if (!isNumber(vi) || !isString(vi) || map[vi]) continue;\r\n        map[vi] = true;\r\n        var r = func(vi);\r\n        if (r === false) break;\r\n    }\r\n};\r\n\r\nvar unique = function (arr) {\r\n    var r = [];\r\n    eachUnique(arr, function (v) {\r\n        r.push(v);\r\n    });\r\n    return r;\r\n};\r\n\r\nvar clone = function (val) {\r\n    var r = val;\r\n    if (isObject(val)) {\r\n        r = {};\r\n        each(val, function (v, p) {\r\n            r[p] = clone(v);\r\n        });\r\n    } else if (isLikeArray(val)) {\r\n        r = new val.constructor();\r\n        each(val, function (v) {\r\n            r.push(clone(v));\r\n        });\r\n    }\r\n    return r;\r\n};\r\n\r\nvar hasProperty = function (val, p) {\r\n    if (isObject(val)) {\r\n        return val.hasOwnProperty(p);\r\n    } else if (isLikeArray(val)) {\r\n        var n = parseInt(p);\r\n        return isNumeric(p) && val.length > n && n >= 0;\r\n    }\r\n    return false;\r\n};\r\n\r\nvar clear = function (val, p, withBasicVal) {\r\n    var inRef = isString(p) || isNumber(p);\r\n    var target = inRef ? val[p] : val;\r\n\r\n    if (isObject(target) || isLikeArray(target)) {\r\n        each(target, function (v, p) {\r\n            clear(target, p);\r\n        });\r\n        if (isLikeArray(target)) {\r\n            shrinkArray(target);\r\n        }\r\n    }\r\n\r\n    if (inRef) {\r\n        val[p] = withBasicVal;\r\n    }\r\n};\r\n\r\nvar shrinkArray = function (arr, len) {\r\n    var limited = isNumber(len);\r\n    if (!limited) {\r\n        each(arr, function (v, i) {\r\n            if (v == null) arr.pop();\r\n        }, true);\r\n    } else {\r\n        each(arr, function (v, i) {\r\n            if (i >= len) arr.pop();\r\n            else return false;\r\n        }, true);\r\n        while (arr.length < len) {\r\n            arr.push(null);\r\n        }\r\n    }\r\n    return arr;\r\n};\r\n\r\nvar touchLeaves = function (obj) {\r\n    each(obj, function (v, p) {\r\n        if (isBasic(v)) {\r\n            obj[p] = v;\r\n        } else {\r\n            touchLeaves(v);\r\n        }\r\n    });\r\n};\r\n\r\nvar extend = function (dest, srcs, clean, handler) {\r\n    if (!isObject(dest)) return srcs;\r\n    var args;\r\n    var argOffset = 0;\r\n    handler = undefined;\r\n    clean = false;\r\n    var lastArg = arguments[arguments.length - 1];\r\n    if (isFunction(lastArg)) {\r\n        argOffset = 2;\r\n        handler = lastArg;\r\n        clean = !!arguments[arguments.length - 2];\r\n    } else if (lastArg === true) {\r\n        argOffset = 1;\r\n        clean = lastArg;\r\n    }\r\n    args = Array.prototype.slice.call(arguments, 1, arguments.length - argOffset);\r\n\r\n    function extendObj(obj, src, clean) {\r\n        if (!isObject(src) && !isLikeArray(src)) return src;\r\n        if (isLikeArray(src)) {\r\n            if (!isLikeArray(obj)) return clone(src);\r\n            else {\r\n                obj.splice.apply(obj, [0, obj.length].concat(src));\r\n                return obj;\r\n            }\r\n        }\r\n        each(src, function (v, p) {\r\n            if (!hasProperty(obj, p) || isBasic(v)) {\r\n                if (obj[p] !== v) {\r\n                    obj[p] = clone(v);\r\n                }\r\n            } else {\r\n                obj[p] = extendObj(obj[p], v, clean);\r\n            }\r\n        });\r\n        if (clean) {\r\n            each(obj, function (v, p) {\r\n                if (!hasProperty(src, p)) {\r\n                    clear(obj, p);\r\n                }\r\n            });\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    each(args, function (src) {\r\n        dest = extendObj(dest, src, clean);\r\n    });\r\n    return dest;\r\n};\r\n\r\nvar allRefs = function (obj) {\r\n    if (isLikeArray(obj)) return [];\r\n    var refs = [];\r\n    each(obj, function (v, p) {\r\n        refs.push(p);\r\n        if (isObject(v)) {\r\n            var f = allRefs(v);\r\n            each(f, function (pp) {\r\n                refs.push(p + '.' + pp);\r\n            });\r\n        }\r\n    })\r\n    return refs;\r\n};\r\n\r\nvar hasRef = function (root, refPath) {\r\n    var v = root;\r\n    var paths = refPath.split('.');\r\n    while (paths.length) {\r\n        var p = paths.shift();\r\n        if (!hasProperty(v, p)) return false;\r\n        v = v[p];\r\n    }\r\n    return true;\r\n};\r\n\r\nvar seekTarget = function (refPath, root) {\r\n    var args = Array.prototype.slice.call(arguments, 1);\r\n    var v;\r\n    for (var i = 0, len = args.length; i < len; i++) {\r\n        v = args[i];\r\n        if (isArray(v)) {\r\n            var r = seekTarget.apply(null, [refPath].concat(v));\r\n            if (r) return r;\r\n        } else {\r\n            if (hasRef(v, refPath)) return v;\r\n        }\r\n    }\r\n};\r\n\r\nvar seekTargetIndex = function (refPath, roots) {\r\n    var index = roots.length - 1;\r\n    each(roots, function (v, i) {\r\n        if (hasRef(v, refPath)) {\r\n            index = i;\r\n            return false;\r\n        }\r\n    });\r\n    return index;\r\n};\r\n\r\nvar refData = function (root, refPath, value) {\r\n    var toSet = arguments.length >= 3;\r\n    var v = root;\r\n    var paths = [];\r\n    if (refPath) paths = refPath.split('.');\r\n\r\n    if (!toSet) {\r\n        while (paths.length) {\r\n            if (isBasic(v)) return undefined;\r\n            v = v[paths.shift()];\r\n        }\r\n        return v;\r\n    } else {\r\n        while (paths.length) {\r\n            if (isBasic(v)) return undefined;\r\n            if (paths.length === 1) {\r\n                v[paths.shift()] = value;\r\n            } else {\r\n                v = v[paths.shift()];\r\n            }\r\n        }\r\n        return value;\r\n    }\r\n};\r\n\r\nfunction addEvent($el, eventName, handler, useCapture) {\r\n    if ($el.addEventListener) {\r\n        $el.addEventListener(eventName, handler, !!useCapture);\r\n    } else {\r\n        if (eventName === 'input') {\r\n            eventName = 'propertychange';\r\n        }\r\n        $el.attachEvent('on' + eventName, handler);\r\n    }\r\n}\r\n\r\nfunction flatten(root, objectFilter, clean) {\r\n    objectFilter = objectFilter || function () { return true; };\r\n    var ext = {};\r\n    each(root, function (v, p) {\r\n        if (isObject(v) && !objectFilter(v)) {\r\n            var f = flatten(v, objectFilter, clean);\r\n            each(f, function (vv, pp) {\r\n                ext[p + '.' + pp] = vv;\r\n            });\r\n        } else {\r\n            if (objectFilter(v) || !clean) {\r\n                ext[p] = v;\r\n            }\r\n        }\r\n    })\r\n    return ext;\r\n}\r\n\r\nexport {\r\n    gid,\r\n    uid,\r\n    isBoolean,\r\n    isNumber,\r\n    isNumeric,\r\n    isString,\r\n    isFunction,\r\n    isObject,\r\n    isArray,\r\n    isLikeArray,\r\n    isBasic,\r\n    isInstance,\r\n    isDirectInstance,\r\n    isNode,\r\n    isNamedNodeMap,\r\n    isEventName,\r\n    isCSSSelector,\r\n    each,\r\n    eachIndexOf,\r\n    eachUnique,\r\n    unique,\r\n    clone,\r\n    hasProperty,\r\n    clear,\r\n    shrinkArray,\r\n    touchLeaves,\r\n    extend,\r\n    allRefs,\r\n    hasRef,\r\n    seekTarget,\r\n    seekTargetIndex,\r\n    refData,\r\n    addEvent,\r\n    flatten\r\n}\r\n","import * as Util from './Util'\r\n\r\nvar canUseProxy = typeof Proxy === 'function';\r\n\r\nfunction defineProperty(target, prop, desc) {\r\n    if (Object.defineProperty) {\r\n        Object.defineProperty(target, prop, desc);\r\n    } else {\r\n        if ('value' in desc) {\r\n            target[prop] = desc.value;\r\n        }\r\n    }\r\n}\r\n\r\nfunction OArray(arr, option) {\r\n    if (Util.isObject(arr) && arguments.length === 1) option = arr;\r\n    if (!Util.isArray(arr)) arr = [];\r\n    if (!option) option = {};\r\n\r\n    defineProperty(this, '__data', {\r\n        value: arr\r\n    });\r\n\r\n    defineProperty(this, 'length', {\r\n        get: function () {\r\n            return arr.length;\r\n        },\r\n        set: function (v) {\r\n            arr.length = v;\r\n        }\r\n    });\r\n\r\n    var _this = this;\r\n\r\n    var eventNames = ['set', 'push', 'pop', 'unshift', 'shift', 'splice', 'resize'];\r\n    eventNames.forEach(function (e) {\r\n        defineProperty(_this, 'on' + e, { value: [] });\r\n    });\r\n    eventNames.forEach(function (e) {\r\n        _this.addEventListener(e, option['on' + e]);\r\n    });\r\n\r\n    Util.each(arr, function (v, i) {\r\n        _this.assignElement(i);\r\n    });\r\n}\r\n\r\nOArray.prototype = [];\r\n\r\nvar __proto__ = OArray.prototype;\r\n\r\n__proto__.constructor = OArray;\r\n\r\n__proto__.on = __proto__.addEventListener = function (eventName, handler) {\r\n    var _this = this;\r\n    if (Util.isObject(eventName)) {\r\n        Util.each(eventName, function (hdl, evt) {\r\n            _this.addEventListener(evt, hdl);\r\n        });\r\n        return;\r\n    }\r\n    if (!this['on' + eventName] || !Util.isFunction(handler)) return;\r\n    this['on' + eventName].push(handler);\r\n};\r\n\r\n__proto__.off = __proto__.removeEventListener = function (eventName, handler) {\r\n    var _this = this;\r\n    if (Util.isObject(eventName)) {\r\n        Util.each(eventName, function (hdl, evt) {\r\n            _this.removeEventListener(evt, hdl);\r\n        });\r\n        return;\r\n    }\r\n    if (!this['on' + eventName] || !Util.isFunction(handler)) return;\r\n    var handlers = this['on' + eventName];\r\n    Util.each(handlers, function (h, i) {\r\n        if (h === handler) {\r\n            handlers.splice(i, 1);\r\n            return false;\r\n        }\r\n    });\r\n};\r\n\r\n__proto__.trigger = __proto__.dispatchEvent = function (eventName, args) {\r\n    args = Array.prototype.slice.call(arguments, 1);\r\n    var _this = this;\r\n    Util.each(this['on' + eventName], function (handler) {\r\n        handler.apply(_this, args);\r\n    });\r\n};\r\n\r\n__proto__.get = function (i) {\r\n    return this.__data[i];\r\n};\r\n\r\n__proto__.set = function (i, v) {\r\n    var e = this.__data[i];\r\n    if (Util.isBasic(e) || Util.isBasic(v)) {\r\n        this.dispatchEvent('set', e, v, i, this.__data);\r\n        this.__data[i] = v;\r\n    } else {\r\n        Util.extend(e, v, true);\r\n    }\r\n};\r\n\r\n__proto__.assignElement = function (i) {\r\n    defineProperty(this, i, {\r\n        get: function () {\r\n            return this.get(i);\r\n        },\r\n        set: function (val) {\r\n            this.set(i, val);\r\n        },\r\n        configurable: true,\r\n        enumerable: true\r\n    });\r\n};\r\n__proto__.deleteElement = function () {\r\n    if (this.hasOwnProperty(this.length - 1)) delete this[this.length - 1];\r\n};\r\n\r\n['push', 'unshift'].forEach(function (f) {\r\n    __proto__[f] = function (v) {\r\n        this.__data[f](v);\r\n        this.assignElement(this.length - 1);\r\n        this.dispatchEvent(f, v);\r\n        this.dispatchEvent('resize');\r\n    };\r\n});\r\n['pop', 'shift'].forEach(function (f) {\r\n    __proto__[f] = function () {\r\n        this.dispatchEvent(f, this.__data[f === 'pop' ? (this.length - 1) : 0]);\r\n        this.deleteElement();\r\n        this.__data[f]();\r\n        this.dispatchEvent('resize');\r\n    };\r\n});\r\n\r\n__proto__.toArray = function (notClone) {\r\n    return notClone ? this.__data : Util.clone(this.__data);\r\n};\r\n\r\n__proto__.splice = function (startIndex, howManyToDelete, itemToInsert) {\r\n    if (!Util.isNumber(startIndex) || startIndex < 0) startIndex = 0;\r\n    if (startIndex >= this.length) startIndex = this.length;\r\n    if (!Util.isNumber(howManyToDelete) || howManyToDelete < 0) howManyToDelete = 0;\r\n    if (howManyToDelete + startIndex > this.length) howManyToDelete = this.length - startIndex;\r\n\r\n    var itemsToDelete = [];\r\n    for (var i = startIndex; i < startIndex + howManyToDelete; i++) {\r\n        itemsToDelete.push(Util.clone(this.get(i)));\r\n    }\r\n\r\n    var itemsToInsert = Array.prototype.slice.call(arguments, 2);\r\n    var howManyToInsert = itemsToInsert.length;\r\n\r\n    var howManyToSet = Math.min(howManyToDelete, howManyToInsert);\r\n    for (var j = startIndex; j < startIndex + howManyToSet; j++) {\r\n        this.set(j, itemsToInsert[j - startIndex]);\r\n    }\r\n\r\n    if (howManyToDelete === howManyToInsert) return;\r\n\r\n    var args;\r\n    if (howManyToDelete > howManyToInsert) {\r\n        args = [startIndex + howManyToInsert, howManyToDelete - howManyToInsert];\r\n        Array.prototype.splice.apply(this.__data, args);\r\n    } else {\r\n        args = [startIndex + howManyToDelete, 0].concat(itemsToInsert.slice(howManyToDelete));\r\n        Array.prototype.splice.apply(this.__data, args);\r\n    }\r\n    this.dispatchEvent.apply(this, ['splice'].concat(args));\r\n    this.dispatchEvent('resize');\r\n};\r\n\r\n__proto__.forEach = function (fn) {\r\n    for (var i = 0; i < this.length; i++) {\r\n        var r = fn(this.get(i), i);\r\n        if (r === false) break;\r\n    }\r\n};\r\n\r\n['reverse', 'sort'].forEach(function (f) {\r\n    __proto__[f] = function () {\r\n        var r = Util.clone(this.__data);\r\n        Array.prototype[f].apply(r, arguments);\r\n        for (var i = 0; i < this.length; i++) {\r\n            this.set(i, r[i]);\r\n        }\r\n    };\r\n});\r\n\r\n['slice', 'concat', 'filter', 'map', 'reduce',\r\n    'indexOf', 'find', 'findIndex', 'fill', 'join'].forEach(function (f) {\r\n    __proto__[f] = function () {\r\n        return Array.prototype[f].apply(this.toArray(), arguments);\r\n    };\r\n});\r\n\r\n__proto__.clear = function () {\r\n    while (this.length) {\r\n        this.pop();\r\n    }\r\n    return this;\r\n};\r\n\r\n__proto__.cast = function (arr) {\r\n    return this.splice.apply(this, [0, this.length].concat(arr));\r\n};\r\n\r\nexport default OArray\r\n","import * as Util from './Util'\r\nimport OArray from './OArray'\r\n\r\nvar GlobalNamespace = '_DMD_';\r\nif (typeof window !== 'object') var window = {};\r\nwindow[GlobalNamespace] = window[GlobalNamespace] || {};\r\nvar Store = window[GlobalNamespace]['Store'] = window[GlobalNamespace]['Store'] || {};\r\nvar Dnstreams = window[GlobalNamespace]['Dnstreams'] = window[GlobalNamespace]['Dnstreams'] || {};\r\nvar ResultsIn = window[GlobalNamespace]['ResultsIn'] = window[GlobalNamespace]['ResultsIn'] || {};\r\nvar Upstreams = window[GlobalNamespace]['Upstreams'] = window[GlobalNamespace]['Upstreams'] || {};\r\nvar ResultsFrom = window[GlobalNamespace]['ResultsFrom'] = window[GlobalNamespace]['ResultsFrom'] || {};\r\nvar Laziness = window[GlobalNamespace]['Laziness'] = window[GlobalNamespace]['Laziness'] || {};\r\nvar PropKernelTable = window[GlobalNamespace]['PropKernelTable'] = window[GlobalNamespace]['PropKernelTable'] || {};\r\nvar KernelStatus = window[GlobalNamespace]['KernelStatus'] = window[GlobalNamespace]['KernelStatus'] || {};\r\nvar GetterSetter = window[GlobalNamespace]['GetterSetter'] = window[GlobalNamespace]['GetterSetter'] || {};\r\nvar __ = {};\r\n\r\nfunction defineProperty(target, prop, desc, proppath) {\r\n    if (!Util.isNode(target)) {\r\n        if (Util.isInstance(target, OArray)) {\r\n            if (desc.set) {\r\n                target.on('set', function (oval, nval, i, arr) {\r\n                    if (i == prop) {\r\n                        desc.set(nval);\r\n                    }\r\n                });\r\n            }\r\n        } else {\r\n            Object.defineProperty(target, prop, desc);\r\n        }\r\n    } else {\r\n        if ('value' in desc) {\r\n            target[prop] = desc.value;\r\n        }\r\n    }\r\n\r\n    if (proppath === false) return;\r\n\r\n    proppath = proppath || fullpathOf(prop, target);\r\n    if (!GetterSetter[proppath] && ('get' in desc || 'set' in desc)) GetterSetter[proppath] = {};\r\n    if ('get' in desc) {\r\n        GetterSetter[proppath].get = desc.get;\r\n    }\r\n    if ('set' in desc) {\r\n        GetterSetter[proppath].set = desc.set;\r\n    }\r\n}\r\n\r\nfunction joinPath(root, path) {\r\n    if (!path || path === '') return root;\r\n    if (!root || root === '') return path;\r\n    return root + '.' + path;\r\n}\r\n\r\nfunction splitPath(path) {\r\n    return path\r\n        .replace(/\"([0-9a-zA-Z$_]+)\"/mg, function (p0, p1) { return p1; })\r\n        .replace(/'([0-9a-zA-Z$_]+)'/mg, function (p0, p1) { return p1; })\r\n        .replace(/\\[([0-9a-zA-Z$_]+)\\]/mg, function (p0, p1) { return '.' + p1; })\r\n        .split('.');\r\n}\r\n\r\nfunction fullpathOf(ref, root) {\r\n    if (root === undefined) return ref;\r\n    var pre = register(root);\r\n    if (pre == null) return ref || '';\r\n    return joinPath(pre, ref);\r\n}\r\n\r\nfunction register(root) {\r\n    if (root === Store || (!Util.isObject(root) && !Util.isNode(root))) return null;\r\n    if (!root.__kernel_root) {\r\n        var id = 'kr_' + Util.uid();\r\n        defineProperty(root, '__kernel_root', {\r\n            value: id\r\n        });\r\n        Store[id] = root;\r\n    }\r\n    return root.__kernel_root;\r\n}\r\n\r\nfunction formatStream(stream, root) {\r\n    if (Util.isObject(stream) || Util.isString(stream)) stream = [stream];\r\n    if (Util.isArray(stream)) {\r\n        return stream.map(function (a) {\r\n            if (Util.isObject(a)) return joinPath(register(a.root), a.alias);\r\n            if (Util.isString(a)) return joinPath(register(root), a);\r\n            return null;\r\n        });\r\n    }\r\n    return [];\r\n}\r\n\r\nfunction propKernelOrder(proppath) {\r\n    if (PropKernelTable[proppath] === undefined) return 0;\r\n    return PropKernelTable[proppath].length;\r\n}\r\n\r\n/**\r\n * Kernel constructor function.\r\n * @constructor\r\n */\r\nfunction Kernel(root, path, relations) {\r\n    if (typeof path === 'string') {\r\n        path = splitPath(path).join('.');\r\n    }\r\n    var obj = {};\r\n    var value;\r\n    obj = scopeOf(path, root);\r\n    if (obj == null) return;\r\n    value = obj.target[obj.property];\r\n\r\n    var proppath;\r\n    if (!obj.target['__proppath']) {\r\n        defineProperty(obj.target, '__proppath', {\r\n            value: joinPath(register(root), splitPath(path).slice(0, -1).join('.'))\r\n        });\r\n        proppath = joinPath(register(root), path);\r\n    } else {\r\n        proppath = joinPath(obj.target['__proppath'], obj.property);\r\n    }\r\n\r\n    var __kid = proppath + '#' + propKernelOrder(proppath);\r\n    defineProperty(this, '__kid', {\r\n        value: __kid\r\n    }, false);\r\n    KernelStatus[this.__kid] = 1;\r\n    if (PropKernelTable[proppath] === undefined) {\r\n        PropKernelTable[proppath] = [];\r\n        if (Util.hasProperty(obj.target, obj.property) && !Util.isInstance(obj.target, OArray)) {\r\n            delete obj.target[obj.property];\r\n        }\r\n    }\r\n    PropKernelTable[proppath].push(1);\r\n\r\n    var dnstream = formatStream(relations.dnstream, root);\r\n    var resultIn = relations.resultIn;\r\n    var upstream = formatStream(relations.upstream, root);\r\n    var resultFrom = relations.resultFrom;\r\n    var lazy = !!relations.lazy;\r\n    if (!Dnstreams[proppath]) Dnstreams[proppath] = {};\r\n    dnstream.forEach(function (p) {\r\n        if (!Upstreams[p]) Upstreams[p] = {};\r\n        if (!Upstreams[p][proppath]) Upstreams[p][proppath] = {};\r\n        Upstreams[p][proppath][__kid] = 1;\r\n        if (!Dnstreams[proppath][p]) Dnstreams[proppath][p] = {};\r\n        Dnstreams[proppath][p][__kid] = 1;\r\n    });\r\n    if (!ResultsIn[proppath]) ResultsIn[proppath] = [];\r\n    ResultsIn[proppath].push(Util.isFunction(resultIn) ? resultIn : null);\r\n    if (!Upstreams[proppath]) Upstreams[proppath] = {};\r\n    upstream.forEach(function (p) {\r\n        if (!Upstreams[proppath][p]) Upstreams[proppath][p] = {};\r\n        Upstreams[proppath][p][__kid] = 1;\r\n        if (!Dnstreams[p]) Dnstreams[p] = {};\r\n        if (!Dnstreams[p][proppath]) Dnstreams[p][proppath] = {};\r\n        Dnstreams[p][proppath][__kid] = 1;\r\n    });\r\n    if (Util.isFunction(resultFrom)) {\r\n        ResultsFrom[proppath] = {\r\n            f: resultFrom,\r\n            k: this.__kid,\r\n            deps: upstream\r\n        };\r\n    }\r\n    if (lazy) Laziness[proppath] = true;\r\n\r\n    if (PropKernelTable[proppath].length === 1) {\r\n        defineProperty(obj.target, obj.property, {\r\n            get: function () {\r\n                if (ResultsFrom[proppath] && KernelStatus[ResultsFrom[proppath].k] !== 0) {\r\n                    var v = ResultsFrom[proppath].f.apply(\r\n                        root,\r\n                        ResultsFrom[proppath].deps.map(function (p) { return Data(null, p); })\r\n                    );\r\n                    if (value !== v) {\r\n                        GetterSetter[proppath].set(v);\r\n                    }\r\n                }\r\n                return value;\r\n            },\r\n            set: function (val, force) {\r\n                if (!force && val === value) return;\r\n                if (val !== value) {\r\n                    if (Util.isInstance(obj.target, OArray) &&\r\n                        !(Util.isObject(value) && Util.isObject(val))) {\r\n                        obj.target.set(obj.property, val);\r\n                        value = obj.target[obj.property];\r\n                    } else {\r\n                        value = Util.extend(value, val);\r\n                    }\r\n                }\r\n\r\n                ResultsIn[proppath] && ResultsIn[proppath].forEach(function (f, k) {\r\n                    f && (KernelStatus[proppath + '#' + k] !== 0) && f.apply(root, [value]);\r\n                });\r\n                if (Dnstreams[proppath]) {\r\n                    Util.each(Dnstreams[proppath], function (kmap, ds) {\r\n                        var toUpdateDnstream = false;\r\n                        Util.each(kmap, function (v, k) {\r\n                            if (KernelStatus[k] !== 0) {\r\n                                toUpdateDnstream = true;\r\n                                return false;\r\n                            }\r\n                        });\r\n                        toUpdateDnstream && ResultsFrom[ds] && !Laziness[ds] && Data(null, ds);\r\n                    });\r\n                }\r\n            },\r\n            // configurable: true,\r\n            enumerable: true\r\n        }, proppath);\r\n    }\r\n\r\n    if (Util.hasProperty(relations, 'value')) {\r\n        Data(null, proppath, relations.value);\r\n    }\r\n}\r\n\r\nKernel.prototype.disable = function () {\r\n    KernelStatus[this.__kid] = 0;\r\n};\r\nKernel.prototype.enable = function () {\r\n    KernelStatus[this.__kid] = 1;\r\n};\r\nKernel.prototype.destroy = function () {};\r\n\r\n/**\r\n * Whether an object is a relation definition.\r\n * @param {Object} obj \r\n * @return {Boolean}\r\n */\r\nfunction isRelationDefinition(obj) {\r\n    if (!Util.isObject(obj)) return false;\r\n    var r = true;\r\n    var specProps = {\r\n        __isRelation: 2, // !\r\n        dnstream: 1, // *\r\n        resultIn: 1, // *\r\n        upstream: 1, // *\r\n        resultFrom: 1, // *\r\n        lazy: true,\r\n        value: true\r\n    };\r\n    var count = 0;\r\n    Util.each(obj, function (v, p) {\r\n        if (specProps[p] === 2) {\r\n            r = true;\r\n            count++;\r\n            return false;\r\n        }\r\n        if (!specProps[p]) {\r\n            r = false;\r\n            return false;\r\n        }\r\n        if (specProps[p] === 1) {\r\n            count++;\r\n        }\r\n    });\r\n    return r && (count > 0);\r\n}\r\n\r\n/**\r\n * Define and bind data with relations in a whole (PropertyPath => Relation) map.\r\n * @param {Object} obj                  The data object. If `relations` is undefined, it contains relations.\r\n * @param {Object|Undefined} relations  A map from propertyPath to relation.\r\n */\r\nfunction Relate(obj, relations) {\r\n    var fr;\r\n    if (arguments.length === 1) {\r\n        if (!Util.isObject(obj)) return null;\r\n        fr = Util.flatten(obj, isRelationDefinition, true);\r\n    } else if (Util.isObject(relations)) {\r\n        fr = Util.flatten(relations, isRelationDefinition, true);\r\n    } else {\r\n        return null;\r\n    }\r\n    Util.each(fr, function (rel, p) {\r\n        new Kernel(obj, p, rel);\r\n    });\r\n\r\n    return obj;\r\n}\r\n\r\n/**\r\n * Get the target and property.\r\n * @param {String} ref \r\n * @param {Object} root \r\n */\r\nfunction scopeOf(ref, root) {\r\n    if (root === undefined) root = Store;\r\n    if ((!Util.isObject(root) && !Util.isNode(root)) || !Util.isString(ref)) return null;\r\n    var fullpath = fullpathOf(ref, root);\r\n    var lastDot = fullpath.lastIndexOf('.');\r\n    var targetPath = fullpath.substring(0, lastDot);\r\n    var propPath = fullpath.substring(lastDot + 1);\r\n    var targetValue = Data(null, targetPath, __, true);\r\n    if (targetValue == null) {\r\n        targetValue = Data(null, targetPath, {}, true);\r\n    }\r\n    return {\r\n        target: targetValue,\r\n        property: propPath\r\n    };\r\n}\r\n\r\nfunction assign(proppath, src, obj) {\r\n    obj = obj || Data(null, proppath);\r\n    Util.each(src, function (v, p) {\r\n        var pp = joinPath(proppath, p);\r\n        if (!Util.hasProperty(obj, p) || Util.isBasic(obj[p]) || Util.isBasic(v)) {\r\n            Data(null, pp, Util.clone(v));\r\n        } else {\r\n            assign(pp, v, obj[p]);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Get or set data, and trigger getters or setters.\r\n */\r\nfunction Data(root, refPath, value, ensurePathValid) {\r\n    root = root || Store;\r\n    var toSet = arguments.length >= 3 && value !== __;\r\n    var v = root;\r\n    // var proppath = fullpathOf(null, root);\r\n    var paths = [];\r\n    if (refPath) paths = splitPath(refPath);\r\n    var parent;\r\n    var prop;\r\n\r\n    while (paths.length) {\r\n        if (ensurePathValid && v == null) {\r\n            parent[prop] = {};\r\n        } else if (Util.isBasic(v)) {\r\n            return undefined;\r\n        }\r\n        prop = paths.shift();\r\n        // proppath += (proppath === '' ? '' : '.') + prop;\r\n        if (toSet && paths.length === 0) { /* set */\r\n            if (Util.isInstance(v, OArray) &&\r\n                !(Util.isObject(v[prop]) && Util.isObject(value))) {\r\n                v.set(prop, value);\r\n            } else {\r\n                v[prop] = Util.extend(v[prop], value);\r\n            }\r\n        } else { /* get */\r\n            parent = v;\r\n            v = v[prop];\r\n        }\r\n    }\r\n    return toSet ? v[prop] : v;\r\n}\r\n\r\nexport { Kernel, Relate, Data }\r\n","import * as Util from './Util'\r\nimport { Data } from './Kernel'\r\nimport OArray from './OArray'\r\n\r\n/**\r\n * Default configurations.\r\n * @type {Object}\r\n */\r\nvar conf = {\r\n    attrPrefix: 'm-',\r\n    refBeginsWithDollar: true,\r\n    attrsFlag: 'attrs.'\r\n};\r\n\r\n/**\r\n * DOM attribute names to bind.\r\n */\r\nvar domProp = {\r\n    'value': 'value',\r\n    'checked': 'checked',\r\n    'innertext': 'innerText',\r\n    'innerhtml': 'innerHTML',\r\n    'class': 'className',\r\n    'style': 'style.cssText'\r\n};\r\n\r\n/**\r\n * Regular expressions.\r\n */\r\nvar Regs = {\r\n    each11: /^\\s*(\\$([a-zA-Z$_][0-9a-zA-Z$_]*))\\s+in\\s+(\\$([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[0-9a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/,\r\n    each12: /^\\s*\\(\\s*(\\$([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*,\\s*(\\$([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*\\)\\s+in\\s+(\\$([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[0-9a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/,\r\n    each21: /^\\s*(([a-zA-Z$_][0-9a-zA-Z$_]*))\\s+in\\s+(([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[0-9a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/,\r\n    each22: /^\\s*\\(\\s*(([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*,\\s*(([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*\\)\\s+in\\s+(([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[0-9a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/\r\n};\r\n\r\n/**\r\n * Execute a function with a data object as the scope.\r\n * @param {String} expr \r\n * @param {Array} refs \r\n * @param {*} target \r\n * @return {*}\r\n */\r\nfunction executeFunctionWithScope(expr, refs, target) {\r\n    if (conf.refBeginsWithDollar) {\r\n        expr = expr.replace(/(\\$[a-zA-Z$_][0-9a-zA-Z$_]*)\\s*=[^=]/g, function (match, p1) {\r\n            return match.replace(p1, 'this.' + p1.substr(1));\r\n        });\r\n    }\r\n\r\n    if (Util.isArray(refs)) {\r\n        if (!target) target = refs[refs.length - 1];\r\n    } else {\r\n        refs = [refs];\r\n        if (!target) target = refs[0];\r\n    }\r\n\r\n    var ref = {};\r\n    Util.each(refs, function (r) {\r\n        Util.each(r, function (v, p) {\r\n            if (p in ref) return;\r\n            if (Util.isFunction(v)) {\r\n                ref[p] = v.bind(target);\r\n            } else {\r\n                ref[p] = v;\r\n            }\r\n        });\r\n    });\r\n\r\n    var params = Object.keys(ref);\r\n    if (conf.refBeginsWithDollar) {\r\n        params = params.map(function (r) {\r\n            return '$' + r;\r\n        });\r\n    }\r\n    var args = Object.values(ref);\r\n    // Util.each(args, function (v, i) {\r\n    //     if (Util.isFunction(v)) {\r\n    //         args[i] = v.bind(ref);\r\n    //     }\r\n    // });\r\n    return (new Function(params.join(','), 'return (' + expr + ')')).apply(target, args);\r\n}\r\n\r\n/**\r\n * Evaluate an expression with a data object.\r\n * @param {String} expr \r\n * @param {Array} refs \r\n * @return {*}\r\n */\r\nfunction evaluateExpression(expr, refs) {\r\n    expr = replaceTmplInStrLiteral(expr);\r\n    var result = null;\r\n    try {\r\n        result = executeFunctionWithScope(expr, refs);\r\n    } catch (e) {}\r\n    return result;\r\n}\r\n\r\n/**\r\n * Fix template strings in a string literal to JavaScript string-concat expressions.\r\n * @param {String} str \r\n * @return {String}\r\n * @example \"'My name is {{name}}.'\" => \"'My name is ' + (name) + '.'\"\r\n */\r\nfunction replaceTmplInStrLiteral(str) {\r\n    var reg = /{{([^{}]*)}}/g;\r\n    return str.replace(reg, function (match, p1) {\r\n        return '\\' + (' + p1 + ') + \\'';\r\n    });\r\n}\r\n\r\n/**\r\n * Evaluate a raw text with template expressions.\r\n * @param {String} text \r\n * @param {Array} refs \r\n * @return {String}\r\n * @example ('My name is {{$name}}.', { name: 'Tom' }) => 'My name is Tom.'\r\n */\r\nfunction evaluateRawTextWithTmpl(text, refs) {\r\n    var reg = /{{([^{}]*)}}/g;\r\n    var result = text.replace(reg, function (match, p1) {\r\n        var result = null;\r\n        try {\r\n            result = executeFunctionWithScope(p1, refs);\r\n        } catch (e) {}\r\n        return result;\r\n    });\r\n    return result;\r\n}\r\n\r\n/**\r\n * Parse reference paths from an expression string.\r\n * @param {String} expr \r\n * @return {Array<String>}\r\n */\r\nfunction parseRefsInExpr(expr) {\r\n    expr = ';' + expr + ';';\r\n    var reg;\r\n    var transformNum = function (r) {\r\n        return r.replace(/\\.([0-9]+)([^0-9a-zA-Z$_]?)/g, function (p0, p1, p2) {\r\n            return '[' + p1 + ']' + p2;\r\n        });\r\n    };\r\n    if (conf.refBeginsWithDollar) {\r\n        expr = expr.replace(/([^a-zA-Z0-9$_.])this\\./mg, function (p0, p1) { return p1 + '$'; });\r\n        reg = /\\$([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[0-9a-zA-Z$_][0-9a-zA-Z$_]*)*/g;\r\n        return (expr.match(reg) || []).map(function (r) {\r\n            return r.substr(1);\r\n        }).map(transformNum);\r\n    } else {\r\n        expr = expr.replace(/([^a-zA-Z0-9$_.])this\\./mg, function (p0, p1) { return p1; });\r\n        reg = /([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[0-9a-zA-Z$_][0-9a-zA-Z$_]*)*/g;\r\n        return (expr.match(reg) || []).map(transformNum);\r\n    }\r\n}\r\n\r\n/**\r\n * Parse `each` template expression from an attribute value string.\r\n * @param {String} expr \r\n * @param {Array} refs\r\n * @return {Object}\r\n */\r\nfunction parseEachExpr(expr, refs) {\r\n    var valStr;\r\n    var keyStr;\r\n    var targetStr;\r\n    var r;\r\n    if (conf.refBeginsWithDollar) {\r\n        r = Regs.each12.exec(expr);\r\n        if (r) {\r\n            valStr = r[1].substr(1);\r\n            keyStr = r[3].substr(1);\r\n            targetStr = r[5].substr(1);\r\n        } else {\r\n            r = Regs.each11.exec(expr);\r\n            valStr = r[1].substr(1);\r\n            targetStr = r[3].substr(1);\r\n        }\r\n    } else {\r\n        r = Regs.each22.exec(expr);\r\n        if (r) {\r\n            valStr = r[1];\r\n            keyStr = r[3];\r\n            targetStr = r[5];\r\n        } else {\r\n            r = Regs.each21.exec(expr);\r\n            valStr = r[1];\r\n            targetStr = r[3];\r\n        }\r\n    }\r\n    var root = Util.seekTarget(targetStr, refs);\r\n    var value = Data(root, targetStr);\r\n    if (!(value instanceof OArray)) {\r\n        value = new OArray(value);\r\n        Data(root, targetStr, value);\r\n    }\r\n    return {\r\n        target: value,\r\n        targetRef: targetStr,\r\n        iterator: {\r\n            val: valStr,\r\n            key: keyStr\r\n        }\r\n    };\r\n}\r\n\r\n/**\r\n * Parse template expression strings from a raw text such as a text node value.\r\n * @param {String} text     [description]\r\n * @return {Array<String>}  [description]\r\n * @example 'My name is {{$name}}. I\\'m {{$age}} years old.' => ['$name', '$age']\r\n */\r\nfunction parseExprsInRawText(text) {\r\n    var reg = /{{([^{}]*)}}/g;\r\n    var exprs = [];\r\n    text.replace(reg, function (match, p1) {\r\n        exprs.push(p1);\r\n        return '';\r\n    });\r\n    return exprs;\r\n}\r\n\r\n/**\r\n * Get relations from an expression string to the data, and apply in time as well.\r\n * @param {String}      expr \r\n * @param {Array}       refs \r\n * @param {Function}    resultFrom \r\n * @return {Object}\r\n */\r\nfunction relationFromExprToRef(expr, refs, target, proppath, resultFrom) {\r\n    if (!Util.isArray(refs)) refs = [refs];\r\n\r\n    function getAllRefs(expr, refs) {\r\n        var refsInExpr = parseRefsInExpr(expr);\r\n        var subData = {};\r\n        Util.each(refsInExpr, function (r) {\r\n            var i = Util.seekTargetIndex(r, refs);\r\n            if (!subData[i]) subData[i] = {};\r\n            subData[i][r] = Data(refs[i], r);\r\n        });\r\n        var re = [];\r\n        Util.each(subData, function (s, i) {\r\n            re.push({\r\n                target: refs[i],\r\n                refs: Util.allRefs(s)\r\n            });\r\n        });\r\n        return re;\r\n    }\r\n\r\n    var targetIsNode = Util.isNode(target);\r\n    var resultIn = function () {\r\n        var result = (resultFrom || function () {\r\n            return evaluateExpression(expr, refs);\r\n        })();\r\n\r\n        /* Transformation */\r\n        if (targetIsNode && proppath === 'className') {\r\n            var classList = [];\r\n            if (Util.isObject(result)) {\r\n                Util.each(result, function (v, p) {\r\n                    v && classList.push(p);\r\n                });\r\n            } else if (Util.isArray(result)) {\r\n                Util.each(result, function (v) {\r\n                    if (Util.isString(v)) classList.push(v);\r\n                    else if (Util.isObject(v)) {\r\n                        Util.each(v, function (vv, pp) {\r\n                            vv && classList.push(pp);\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            result = classList.join(' ');\r\n        } else if (targetIsNode && proppath === 'style.cssText') {\r\n            var stylePairs = [];\r\n            if (Util.isObject(result)) {\r\n                Util.each(result, function (v, p) {\r\n                    stylePairs.push(p + ':' + v);\r\n                });\r\n            }\r\n            result = stylePairs.join(';');\r\n        }\r\n\r\n        if (targetIsNode && proppath.startsWith(conf.attrsFlag)) {\r\n            if (result != null) {\r\n                var attrName = proppath.substr(conf.attrsFlag.length);\r\n                target.setAttribute(attrName, result);\r\n            }\r\n        } else {\r\n            Data(target, proppath, result);\r\n        }\r\n    };\r\n\r\n    var r = getAllRefs(expr, refs).map(function (a) {\r\n        return {\r\n            target: a.target,\r\n            relations: (function () {\r\n                var r = {};\r\n                a.refs.forEach(function (refpath) {\r\n                    r[refpath] = {\r\n                        resultIn: resultIn\r\n                    };\r\n                });\r\n                return r;\r\n            })()\r\n        };\r\n    });\r\n    resultIn();\r\n    return r;\r\n}\r\n\r\nexport {\r\n    conf,\r\n    domProp,\r\n    relationFromExprToRef,\r\n    executeFunctionWithScope,\r\n    parseExprsInRawText,\r\n    evaluateRawTextWithTmpl,\r\n    parseEachExpr\r\n}\r\n","import './Polyfill'\r\nimport * as Util from './Util'\r\nimport { Kernel, Relate, Data } from './Kernel'\r\nimport * as Parser from './Parser'\r\n\r\n/**\r\n * Default configurations.\r\n * @type {Object}\r\n */\r\nvar conf = {\r\n    domBoundFlag: '__dmd_bound',\r\n    domListKey: '__dmd_key'\r\n};\r\n\r\nvar domValueToBind = {\r\n    'input': 'input',\r\n    'select': 'change'\r\n};\r\n\r\n/**\r\n * Bind data to DOM.\r\n * @param  {HTMLElement} $el            [description]\r\n * @param  {Object} ref                 [description]\r\n * @param  {Array} ext                  [description]\r\n * @return {[type]}                     [description]\r\n */\r\nfunction Bind($el, ref, ext) {\r\n    if (!Util.isNode($el) || !Util.isObject(ref)) return null;\r\n    ext = ext ? (Util.isArray(ext) ? ext : [ext]) : []; /* Ensure `ext` is an array */\r\n    var scopes = ext.concat(ref);\r\n\r\n    var nodeName = $el.nodeName.toLowerCase();\r\n\r\n    if ($el.nodeType === Node.ELEMENT_NODE && !$el[conf.domBoundFlag]) {\r\n        $el[conf.domBoundFlag] = true; /* Set a binding flag. */\r\n\r\n        /* Bind a list */\r\n        if ($el.hasAttribute(Parser.conf.attrPrefix + 'each')) {\r\n            var eachAttrName = Parser.conf.attrPrefix + 'each';\r\n            var eachExprText = $el.getAttribute(eachAttrName);\r\n            var eachExpr = Parser.parseEachExpr(eachExprText, ref);\r\n            $el.removeAttribute(eachAttrName);\r\n            var $parent = $el.parentNode;\r\n            // $parent.removeChild($el);\r\n            $parent.innerHTML = '';\r\n\r\n            var $targetList = eachExpr.target;\r\n\r\n            function bindItem(v, k) {\r\n                var $copy = $el.cloneNode(true);\r\n                var _ext = {};\r\n                _ext[eachExpr.iterator.val] = v;\r\n                if (eachExpr.iterator.key) _ext[eachExpr.iterator.key] = k;\r\n                Bind($copy, ref, [_ext].concat(ext));\r\n\r\n                $targetList.on({\r\n                    set: function (oval, nval, i, arr) {\r\n                        if (i == k) {\r\n                            console.log('set', i, nval);\r\n                            _ext[eachExpr.iterator.val] = nval;\r\n                        }\r\n                    },\r\n                    // push: function (v) {},\r\n                    unshift: function (v) {\r\n                        k++;\r\n                        _ext[eachExpr.iterator.key] = k;\r\n                    },\r\n                    // pop: function () {},\r\n                    shift: function () {\r\n                        if (k > 0) {\r\n                            k--;\r\n                            _ext[eachExpr.iterator.key] = k;\r\n                        }\r\n                    },\r\n                    splice: function (startIndex, howManyToDelete, itemToInsert) {\r\n                        if (howManyToDelete) {\r\n                            if (k >= startIndex + howManyToDelete) {\r\n                                k -= howManyToDelete;\r\n                                _ext[eachExpr.iterator.key] = k;\r\n                            }\r\n                        } else {\r\n                            var howManyItemsToInsert = Array.prototype.slice.call(arguments, 2).length;\r\n                            if (k >= startIndex) {\r\n                                k += howManyItemsToInsert;\r\n                                _ext[eachExpr.iterator.key] = k;\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return $copy;\r\n            }\r\n\r\n            Util.each($targetList, function (v, i) {\r\n                $parent.appendChild(bindItem(v, i));\r\n            });\r\n\r\n            $targetList.on({\r\n                // set: function (oval, nval, i, arr) {},\r\n                resize: function () {\r\n                    if ($parent.nodeName.toLowerCase() === 'select') {\r\n                        $parent.dispatchEvent(new Event('change'));\r\n                    }\r\n                },\r\n                push: function (v) {\r\n                    $parent.appendChild(bindItem(v, $targetList.length - 1));\r\n                },\r\n                unshift: function (v) {\r\n                    $parent.insertBefore(bindItem(v, 0), $parent.childNodes[0]);\r\n                },\r\n                pop: function () {\r\n                    $parent.removeChild($parent.lastChild);\r\n                },\r\n                shift: function () {\r\n                    $parent.removeChild($parent.firstChild);\r\n                },\r\n                splice: function (startIndex, howManyToDelete, itemToInsert) {\r\n                    if (howManyToDelete) {\r\n                        for (; howManyToDelete > 0; howManyToDelete--) {\r\n                            $parent.removeChild($parent.childNodes[startIndex]);\r\n                        }\r\n                    } else {\r\n                        var itemsToInsert = Array.prototype.slice.call(arguments, 2);\r\n                        Util.each(itemsToInsert, function (v, i) {\r\n                            $parent.insertBefore(bindItem(v, startIndex + i), $parent.childNodes[startIndex + i]);\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n\r\n            return;\r\n        }\r\n\r\n        /* Bind child nodes recursively */\r\n        Util.each($el, function (node) {\r\n            Bind(node, ref, ext);\r\n        });\r\n\r\n        /* Bind attributes */\r\n        var attrList = [];\r\n        Util.each($el.attributes, function (value, name) {\r\n            if (!name.startsWith(Parser.conf.attrPrefix)) return;\r\n            attrList.push(name);\r\n            name = name.substr(Parser.conf.attrPrefix.length).toLowerCase();\r\n\r\n            var eventName = Util.isEventName(name);\r\n            if (eventName) { /* Event */\r\n                Util.addEvent($el, eventName, function (e) {\r\n                    Parser.executeFunctionWithScope(value, [{\r\n                        e: e\r\n                    }].concat(scopes));\r\n                }, true);\r\n                return;\r\n            }\r\n\r\n            if (domValueToBind[nodeName] && name === 'value') { /* Two-way binding */\r\n                var valueProp = Parser.conf.refBeginsWithDollar ? value.substr(1) : value;\r\n                var valueTarget = Util.seekTarget(valueProp, ext, ref);\r\n                Util.addEvent($el, domValueToBind[nodeName], function (e) {\r\n                    console.log('input change');\r\n                    Data(valueTarget, valueProp, this.value);\r\n                }, false);\r\n            }\r\n\r\n            if (Parser.domProp[name]) name = Parser.domProp[name];\r\n            else name = Parser.conf.attrsFlag + name; /* Attribute */\r\n\r\n            /* Binding */\r\n            var allrel = Parser.relationFromExprToRef(value, scopes, $el, name);\r\n            allrel.forEach(function (a) {\r\n                Relate(a.target, a.relations);\r\n            });\r\n        });\r\n\r\n        /* Clean attributes */\r\n        Util.each(attrList, function (name) {\r\n            $el.removeAttribute(name);\r\n        });\r\n    } else if ($el.nodeType === Node.TEXT_NODE) {\r\n        var tmpl = $el.nodeValue;\r\n        var expr = Parser.parseExprsInRawText(tmpl).join(';');\r\n        if (expr === '') return null;\r\n\r\n        /* Binding */\r\n        var allrel;\r\n        var $targetEl = $el;\r\n        var targetRef = 'nodeValue';\r\n        if ($el.parentNode.nodeName.toLowerCase() === 'textarea') {\r\n            $targetEl = $el.parentNode;\r\n            targetRef = 'value';\r\n        }\r\n        allrel = Parser.relationFromExprToRef(expr, scopes, $targetEl, targetRef, function () {\r\n            return Parser.evaluateRawTextWithTmpl(tmpl, scopes);\r\n        });\r\n        allrel.forEach(function (a) {\r\n            Relate(a.target, a.relations);\r\n        });\r\n    }\r\n\r\n    return $el;\r\n}\r\n\r\n/**\r\n * Unbind data from DOM.\r\n * @param       {[type]} $el      [description]\r\n * @param       {[type]} ref      [description]\r\n * @param       {[type]} relation [description]\r\n * @constructor\r\n */\r\nfunction Unbind($el, ref, relation) {\r\n    // TODO\r\n}\r\n\r\n/**\r\n * Constructor.\r\n * @param {*} $el   [description]\r\n * @param {*} ref   [description]\r\n */\r\nvar DMD = function ($el, ref) {\r\n    if (Util.isString($el)) {\r\n        $el = window.document.querySelector($el);\r\n    }\r\n    if (Util.isString(ref) && arguments.length > 2) {\r\n        var html = ref;\r\n        ref = arguments[2];\r\n\r\n        var frag = document.createDocumentFragment();\r\n        var div = document.createElement('div');\r\n        div.innerHTML = html;\r\n\r\n        while (div.childNodes.length > 0) {\r\n            Bind.call(this, div.childNodes[0], ref);\r\n            frag.appendChild(div.childNodes[0]);\r\n        }\r\n        $el.appendChild(frag);\r\n    } else {\r\n        Bind.call(this, $el, ref);\r\n    }\r\n};\r\n\r\nDMD.kernel = Kernel;\r\nDMD.relate = Relate;\r\nDMD.$ = Data;\r\n\r\nexport default DMD\r\n","(function () {\r\n    // Array.prototype.forEach\r\n    // Array.prototype.filter\r\n    // Array.prototype.map\r\n    // String.prototype.trim\r\n    // String.prototype.startsWith\r\n    // String.prototype.endsWith\r\n    // Object.keys\r\n    if (!Object.keys) {\r\n        Object.keys = function (o) {\r\n            if (o !== Object(o)) throw new TypeError('Object.keys called on a non-object');\r\n            var k = [];\r\n            for (var p in o) if (Object.prototype.hasOwnProperty.call(o, p)) k.push(p);\r\n            return k;\r\n        };\r\n    }\r\n    // Object.values\r\n    if (!Object.values) {\r\n        Object.values = function (o) {\r\n            if (o !== Object(o)) throw new TypeError('Object.values called on a non-object');\r\n            var v = [];\r\n            for (var p in o) if (Object.prototype.hasOwnProperty.call(o, p)) v.push(o[p]);\r\n            return v;\r\n        };\r\n    }\r\n})();\r\n"],"names":["addEvent","$el","eventName","handler","useCapture","addEventListener","attachEvent","flatten","root","objectFilter","clean","ext","each","v","p","isObject","f","vv","pp","defineProperty","target","prop","desc","Object","value","OArray","arr","option","Util.isObject","arguments","length","Util.isArray","this","get","set","_this","eventNames","forEach","e","Util.each","i","assignElement","proppath","Util.isNode","Util.isInstance","on","oval","nval","fullpathOf","GetterSetter","joinPath","path","splitPath","replace","p0","p1","split","ref","undefined","pre","register","Store","__kernel_root","id","Util.uid","formatStream","stream","Util.isString","map","a","alias","Kernel","relations","join","obj","fullpath","lastDot","lastIndexOf","targetPath","substring","propPath","targetValue","Data","__","property","scopeOf","slice","__kid","PropKernelTable","propKernelOrder","KernelStatus","Util.hasProperty","push","dnstream","resultIn","upstream","resultFrom","lazy","Dnstreams","Upstreams","ResultsIn","Util.isFunction","ResultsFrom","k","deps","Laziness","apply","val","force","Util.extend","kmap","ds","toUpdateDnstream","enumerable","isRelationDefinition","r","specProps","__isRelation","count","Relate","fr","Util.flatten","rel","refPath","ensurePathValid","toSet","paths","parent","Util.isBasic","shift","executeFunctionWithScope","expr","refs","conf","refBeginsWithDollar","match","substr","bind","params","keys","args","values","Function","relationFromExprToRef","targetIsNode","result","str","replaceTmplInStrLiteral","evaluateExpression","classList","stylePairs","startsWith","attrsFlag","attrName","setAttribute","refsInExpr","reg","transformNum","p2","parseRefsInExpr","subData","Util.seekTargetIndex","re","s","Util.allRefs","getAllRefs","refpath","Bind","scopes","concat","nodeName","toLowerCase","nodeType","Node","ELEMENT_NODE","domBoundFlag","TEXT_NODE","tmpl","nodeValue","text","exprs","Parser.parseExprsInRawText","$targetEl","targetRef","parentNode","Parser.relationFromExprToRef","Parser.evaluateRawTextWithTmpl","hasAttribute","Parser.conf","attrPrefix","eachAttrName","eachExpr","valStr","keyStr","targetStr","Regs","each12","exec","each11","each22","each21","Util.seekTarget","iterator","key","Parser.parseEachExpr","getAttribute","removeAttribute","$parent","innerHTML","$targetList","bindItem","$copy","cloneNode","_ext","console","log","unshift","splice","startIndex","howManyToDelete","itemToInsert","howManyItemsToInsert","Array","prototype","call","appendChild","resize","dispatchEvent","Event","insertBefore","childNodes","pop","removeChild","lastChild","firstChild","itemsToInsert","node","attrList","attributes","name","Util.isEventName","Util.addEvent","Parser.executeFunctionWithScope","domValueToBind","valueProp","valueTarget","Parser.domProp","o","TypeError","hasOwnProperty","uid","Date","getTime","Math","floor","random","isNumber","isString","isFunction","toString","isArray","isLikeArray","isBasic","isInstance","creator","isNode","isEventName","func","arrayReverse","len","ret","COMMENT_NODE","PROCESSING_INSTRUCTION_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NamedNodeMap","isNamedNodeMap","clone","constructor","hasProperty","n","parseInt","isNaN","isNumeric","clear","withBasicVal","inRef","shrinkArray","extend","dest","srcs","extendObj","src","argOffset","lastArg","allRefs","hasRef","seekTarget","seekTargetIndex","roots","index","__proto__","hdl","evt","off","removeEventListener","handlers","h","trigger","__data","configurable","deleteElement","toArray","notClone","Util.clone","Util.isNumber","itemsToDelete","howManyToInsert","howManyToSet","min","j","fn","cast","window","disable","enable","destroy","domProp","checked","innertext","innerhtml","class","style","domListKey","input","select","DMD","document","querySelector","html","frag","createDocumentFragment","div","createElement","kernel","relate","$"],"mappings":"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"}